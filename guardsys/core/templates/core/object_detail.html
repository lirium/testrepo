{% load humanize %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ object.name }}</title>
    <style>
        body { font-family: system-ui, sans-serif; margin: 1rem; }
        .btn { padding: 6px 10px; border: 1px solid #888; background: #f9f9f9; border-radius: 6px; text-decoration: none; color: #000; }
        .overdue { color: #b00020; font-weight: 600; }
        .ok { color: #007c3d; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { border: 1px solid #ddd; border-radius: 8px; padding: 12px; }
        h2 { margin-top: 0; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 4px 6px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <a class="btn" href="{% url 'object_list' %}">← К списку</a>
    <h1>{{ object.name }}</h1>
    <p><strong>Адрес:</strong> {{ object.address }}</p>
    <p><strong>Организация:</strong> {{ object.organization.name }} (ИНН {{ object.organization.inn }})</p>
    <p><strong>Оборудование:</strong><br/> {{ object.equipment|linebreaksbr }}</p>
    <p><strong>Ответственные:</strong> {{ object.main_responsible.get_full_name|default:object.main_responsible.username }}{% if object.deputy_responsible %}, {{ object.deputy_responsible.get_full_name|default:object.deputy_responsible.username }}{% endif %}</p>

    <div class="grid">
        <div class="card">
            <h2>ТО</h2>
            {% with m=maintenance %}
                <p><strong>Следующее ТО:</strong> {% if m %}{{ m.next_due_at|date:"d.m.Y" }}{% else %}-{% endif %}
                {% if m and m.is_overdue %}<span class="overdue">● Просрочено</span>{% elif m %}<span class="ok">○ В норме</span>{% endif %}
                </p>
                <form method="post" action="{% url 'mark_maintenance_done' object.id %}">
                    {% csrf_token %}
                    <button class="btn" type="submit">Отметить ТО пройдено</button>
                </form>
            {% endwith %}
        </div>
        <div class="card">
            <h2>Архивирование</h2>
            {% if not object.is_deleted %}
            <form method="post" action="{% url 'object_archive' object.id %}">
                {% csrf_token %}
                <input type="text" name="reason" placeholder="Причина" required />
                <button class="btn" type="submit">Переместить в архив</button>
            </form>
            {% else %}
            <form method="post" action="{% url 'object_restore' object.id %}">
                {% csrf_token %}
                <button class="btn" type="submit">Восстановить</button>
            </form>
            {% endif %}
        </div>
    </div>

    <div class="card" style="margin-top:20px">
        <h2>Документы</h2>
        <form method="post" action="{% url 'upload_document' object.id %}" enctype="multipart/form-data" style="margin-bottom:10px">
            {% csrf_token %}
            <input type="file" name="file" required />
            <button class="btn" type="submit">Загрузить</button>
        </form>
        <table>
            <thead><tr><th>Имя файла</th><th>Дата</th></tr></thead>
            <tbody>
                {% for d in documents %}
                <tr><td><a href="{{ d.file.url }}" target="_blank" rel="noopener">{{ d.original_name }}</a></td><td>{{ d.uploaded_at|date:"d.m.Y H:i" }}</td></tr>
                {% empty %}
                <tr><td colspan="2">Документы отсутствуют</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</body>
</html>

